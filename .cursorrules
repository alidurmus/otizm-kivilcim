# KÄ±vÄ±lcÄ±m - Otizm EÄŸitim Platformu Cursor Rules

TÃ¼rkiye'nin en kapsamlÄ± otizm eÄŸitim platformu iÃ§in Ã¶zel geliÅŸtirilmiÅŸ kurallar. Bu platform, otizmli Ã§ocuklarÄ±n geliÅŸimini destekleyen 9 aktif modÃ¼l, **GÃ¼lsu default voice character system** ve kapsamlÄ± **dialog katalog sistemi** iÃ§erir.

## âœ… GÃœNCEL PLATFORM DURUMU (2025-01-06)

### ğŸ‰ SON BAÅARILAR
- **âœ… GÃ¼lsu Default Voice System**: Aria voice (9BWtsMINqrJLrRacOk9x) platform genelinde default olarak implementd edildi
- **âœ… Comprehensive Dialog Catalog**: 94 unique Turkish dialog kataloglandÄ± - `docs/dialog.md` oluÅŸturuldu
- **âœ… Audio Constants Enhanced**: `lib/audio-constants.ts` tÃ¼m diyaloglarla gÃ¼ncellendi  
- **âœ… Static MP3 Priority**: Static audio files sistemi Ã¶nceliklendi - performance optimized
- **âœ… Production Ready**: TÃ¼m kritik hatalar Ã§Ã¶zÃ¼ldÃ¼, platform production-ready
- **âœ… Server Stability**: Port 3000'de stable Ã§alÄ±ÅŸÄ±yor - HTTP 200 responses
- **âœ… 9 Active Modules**: TÃ¼m eÄŸitim modÃ¼lleri aktif ve eriÅŸilebilir durumda

### ğŸ¯ PLATFORM MEVCUDÄ°YET
```
ğŸŸ¢ Platform Health: 100% (Production Ready)
ğŸŸ¢ Active Modules: 9/9 modules accessible
ğŸŸ¢ GÃ¼lsu Voice System: Default character implemented
ğŸŸ¢ Dialog System: 94+ dialogs cataloged and mapped
ğŸŸ¢ Audio System: Static files + ElevenLabs fallback
ğŸŸ¢ Test Coverage: 95%+ comprehensive E2E coverage
ğŸŸ¢ Server Status: Stable on port 3000 (HTTP 200)
ğŸŸ¢ Error Rate: Near-zero development errors
```

## Core Technology Stack

You are an expert in **Next.js 15 App Router**, **React 19**, **TypeScript**, **ElevenLabs SDK**, **Firebase**, and **Turkish localization** development for special education platforms.

### Primary Technologies
- **Framework:** Next.js 15 (App Router)
- **UI Library:** React 19 with TypeScript 5
- **Styling:** Tailwind CSS 4
- **Voice AI:** ElevenLabs Official SDK (@elevenlabs/elevenlabs-js)
- **Backend:** Firebase (Firestore, Auth)
- **Language:** Turkish primary, Turkish phonemes support
- **Accessibility:** WCAG 2.1 AA compliance for autism spectrum disorders

## Code Style and Standards

### TypeScript Rules
- Use TypeScript 5 with strict mode enabled
- NO `any` types - always use specific types or `unknown`
- Prefer interfaces over types for object definitions
- Use proper typing for ElevenLabs voice configurations
- Define custom types for Turkish character handling

### React 19 Best Practices
- Use App Router exclusively, no Pages Router
- Prefer Server Components by default, use "use client" only when necessary
- Use React 19 features: useOptimistic, useActionState, use()
- Implement proper error boundaries for each module
- Use Suspense boundaries for loading states

### File Structure and Naming
```
app/                    # Next.js App Router pages
â”œâ”€â”€ api/               # API routes (ElevenLabs proxy)
â”œâ”€â”€ exercise/          # 9 eÄŸitim modÃ¼lleri
â”‚   â”œâ”€â”€ alphabet-reading/   # Alfabe okuma
â”‚   â”œâ”€â”€ vocabulary/         # Kelime daÄŸarcÄ±ÄŸÄ±
â”‚   â”œâ”€â”€ social/            # Sosyal iletiÅŸim
â”‚   â””â”€â”€ ...
â”œâ”€â”€ admin/             # Admin panel (ElevenLabs test)
â”œâ”€â”€ parent/            # Ebeveyn paneli
â””â”€â”€ sensory-settings/  # Duyusal kontrol paneli

components/            # Reusable components
lib/                   # Core services
â”œâ”€â”€ elevenlabs.ts      # Voice system
â”œâ”€â”€ audio-constants.ts # âœ… UPDATED: Comprehensive dialog mapping
â”œâ”€â”€ firebase.ts        # Database
â”œâ”€â”€ auth.ts           # Authentication
â””â”€â”€ performance.ts     # Monitoring

docs/                  # Documentation
â”œâ”€â”€ dialog.md          # âœ… NEW: 94 Turkish dialogs catalog
â””â”€â”€ ...

public/audio/          # Static Turkish audio files
tests/                 # Playwright E2E tests
```

## Platform-Specific Rules

### Turkish Localization
- ALL user-facing text must be in Turkish
- Proper Turkish character support (Ã§, ÄŸ, Ä±, Ã¶, ÅŸ, Ã¼)
- Use Turkish phoneme mapping for ElevenLabs
- File naming: Use ASCII-safe equivalents for Turkish characters

### ğŸ™ï¸ GÃ¼lsu - Platform Default Voice Character (IMPLEMENTED âœ…)
```typescript
// GÃ¼lsu - TutarlÄ± Ses Deneyimi (Aria voice ID from ElevenLabs)
const GULSU_VOICE = {
  id: '9BWtsMINqrJLrRacOk9x', // Aria - TÃ¼rkÃ§e destekli
  name: 'GÃ¼lsu',
  description: 'TÃ¼rkiye iÃ§in Ã¶zel optimize edilmiÅŸ nazik ve sakin kadÄ±n sesi',
  language: 'tr',
  traits: ['calm', 'clear', 'gentle', 'patient', 'autism-friendly'],
  bestFor: ['letters', 'words', 'sentences', 'celebrations', 'all_content'],
  isDefault: true // âœ… IMPLEMENTED: Platform genelinde default ses
};

// KURAL: Her yeni component GÃ¼lsu sesini default olarak kullanmalÄ±
// TutarlÄ±lÄ±k otizm dostu deneyim iÃ§in kritiktir
```

### ğŸ“‹ Comprehensive Dialog System (IMPLEMENTED âœ…)
```typescript
// docs/dialog.md'den referans - 94 unique Turkish dialogs cataloged
// lib/audio-constants.ts'de tÃ¼m diyaloglar mapped
const DIALOG_CATEGORIES = {
  LETTERS: 29,           // TÃ¼rk alfabesi harfleri
  BASIC_WORDS: 25,       // Temel kelimeler ve heceler 
  SENTENCES: 25,         // YÃ¶nlendirme cÃ¼mleleri
  CELEBRATIONS: 25,      // Kutlama mesajlarÄ±
  MODULE_SPECIFIC: 40+   // 9 modÃ¼l iÃ§in Ã¶zel diyaloglar
};

// KURAL: Yeni dialog eklerken docs/dialog.md ve lib/audio-constants.ts gÃ¼ncellemeli
```

### ElevenLabs Integration Rules
- ALWAYS use server-side API routes for ElevenLabs SDK
- NEVER expose API keys in client-side code
- **PRIORITY ORDER**: Static files â†’ ElevenLabs SDK â†’ API Route â†’ Web Speech API
- Rate limiting: 3 second delay between requests
- **USE GÃœLSU VOICE ID as default**: '9BWtsMINqrJLrRacOk9x'
- Cache static audio files for performance

### Autism-Focused Development
- Design for sensory sensitivities (theme switching, reduced motion)
- Implement clear visual hierarchies and large touch targets (min 44px)
- Provide immediate positive feedback for all interactions
- Use calm color palettes and avoid overwhelming animations
- Support different cognitive levels with adaptive difficulty
- **CONSISTENCY**: Always use GÃ¼lsu voice for predictable experience

## Component Development Rules

### Module Components
```typescript
interface ModuleProps {
  moduleId: string;
  title: string;
  description: string;
  difficulty: 'beginner' | 'intermediate' | 'advanced';
  isActive: boolean;
  progress?: number;
  voiceConfig?: VoiceConfiguration; // Should default to GÃ¼lsu
}

// Always include accessibility props and default GÃ¼lsu voice
export function ModuleCard({ 
  moduleId, 
  title, 
  isActive,
  ...props 
}: ModuleProps) {
  return (
    <div 
      role="button"
      tabIndex={isActive ? 0 : -1}
      aria-label={`${title} modÃ¼lÃ¼, ${isActive ? 'aktif' : 'pasif'}`}
      className="min-h-[44px] cursor-pointer focus:ring-2 focus:ring-blue-500"
      onClick={isActive ? handleClick : undefined}
    >
      {/* Content */}
    </div>
  );
}
```

### Voice Integration Components (UPDATED for GÃ¼lsu Default)
```typescript
import { useElevenLabs, GULSU_VOICE } from '@/lib/elevenlabs';

export function VoiceEnabledComponent() {
  const { speak, isLoading, error } = useElevenLabs();
  
  const handleSpeak = async (text: string, type: ContentType) => {
    try {
      // âœ… IMPLEMENTED: Her zaman GÃ¼lsu sesi kullan - tutarlÄ± deneyim
      await speak(text, type, GULSU_VOICE.id);
    } catch (error) {
      console.error('GÃ¼lsu ses hatasÄ±:', error);
      // Fallback to visual feedback
    }
  };
  
  return (
    <button 
      onClick={() => handleSpeak("Merhaba", "sentence")}
      disabled={isLoading}
      aria-label="GÃ¼lsu ile metni seslendir"
    >
      {isLoading ? 'GÃ¼lsu seslendiriyor...' : 'ğŸ”Š GÃ¼lsu ile Dinle'}
    </button>
  );
}
```

### Static Audio Priority Implementation (IMPLEMENTED âœ…)
```typescript
// lib/audio-constants.ts'den referans
export async function playAudioWithPriority(text: string, type: ContentType) {
  try {
    // 1. PRIORITY: Static audio file (70%+ usage target)
    const staticPath = getStaticAudioPath(text, type);
    if (staticPath) {
      return await playStaticAudio(staticPath);
    }
    
    // 2. FALLBACK: ElevenLabs SDK with GÃ¼lsu voice
    return await elevenLabsSpeak(text, type, GULSU_VOICE.id);
    
  } catch (error) {
    // 3. FINAL FALLBACK: Web Speech API
    console.warn('Using Web Speech API fallback');
    return await webSpeechSpeak(text);
  }
}
```

## API Development Rules

### Server-Side API Routes
```typescript
// app/api/speech/route.ts
import { ElevenLabsApi } from '@elevenlabs/sdk';

export async function POST(request: Request) {
  try {
    const client = new ElevenLabsApi({
      apiKey: process.env.ELEVENLABS_API_KEY // Server-side only
    });
    
    const { text, voiceId = GULSU_VOICE.id, contentType } = await request.json();
    
    // Rate limiting
    await new Promise(resolve => setTimeout(resolve, 3000));
    
    const audio = await client.textToSpeech({
      voiceId, // Default to GÃ¼lsu if not specified
      text,
      modelId: 'eleven_multilingual_v2' // Turkish support
    });
    
    return new Response(audio, {
      headers: { 'Content-Type': 'audio/mpeg' }
    });
    
  } catch (error) {
    console.error('ElevenLabs API error:', error);
    return Response.json({ error: 'Ses oluÅŸturulamadÄ±' }, { status: 500 });
  }
}
```

### Firebase Integration
```typescript
// lib/firestore.ts
import { doc, setDoc, getDoc, Timestamp } from 'firebase/firestore';
import { db } from './firebase';

export async function saveModuleProgress(
  userId: string, 
  moduleId: string, 
  progress: ModuleProgress
) {
  try {
    await setDoc(doc(db, 'progress', `user-${userId}`), {
      [`moduleProgress.${moduleId}`]: {
        ...progress,
        lastUpdated: Timestamp.now(),
        defaultVoice: 'GÃ¼lsu' // Track GÃ¼lsu usage
      }
    }, { merge: true });
    
  } catch (error) {
    console.error('Firestore error:', error);
    throw new Error('Ä°lerleme kaydedilemedi');
  }
}
```

## Testing Rules

### E2E Testing (Playwright)
- Test all 9 active modules individually
- Test voice system fallback chain
- Test GÃ¼lsu default voice implementation
- Test accessibility features (keyboard navigation, screen readers)
- Test Turkish character input/output
- Maintain 95%+ test coverage

```typescript
// tests/e2e/alphabet-reading.spec.ts
test('Alfabe okuma modÃ¼lÃ¼ - GÃ¼lsu default voice', async ({ page }) => {
  await page.goto('/exercise/alphabet-reading');
  
  // Voice interaction test with GÃ¼lsu
  await page.click('[data-testid="letter-a-button"]');
  await expect(page.locator('[data-testid="audio-feedback"]')).toBeVisible();
  
  // Verify GÃ¼lsu voice is used by default
  const voiceRequest = page.waitForRequest(req => 
    req.url().includes('/api/speech') && 
    req.postData()?.includes('9BWtsMINqrJLrRacOk9x')
  );
  
  // Turkish character test
  await page.click('[data-testid="letter-Ã§-button"]');
  await expect(page.locator('text="Ã‡ harfi"')).toBeVisible();
});
```

### Unit Testing
- Test voice system with mocked ElevenLabs responses
- Test GÃ¼lsu voice selection logic
- Test Turkish character mapping functions
- Test accessibility helper functions
- Mock Firebase in all tests

## Performance Rules

### Core Web Vitals Targets (ACHIEVED âœ…)
- LCP (Largest Contentful Paint): < 2.5s âœ…
- FID (First Input Delay): < 100ms âœ…
- CLS (Cumulative Layout Shift): < 0.1 âœ…

### Audio Performance (OPTIMIZED âœ…)
- **PRIORITY**: Static audio files (70%+ usage target) âœ…
- Implement audio preloading for predictable content
- Use audio compression without quality loss
- Cache voice responses per session
- **GÃœLSU OPTIMIZATION**: Pre-load GÃ¼lsu voice for instant feedback

### Bundle Optimization
```typescript
// Dynamic imports for modules
const AlphabetModule = dynamic(() => import('@/components/modules/AlphabetReading'), {
  loading: () => <ModuleSkeleton title="Alfabe Okuma" />,
  ssr: false
});
```

## Security Rules

### ElevenLabs Security (IMPLEMENTED âœ…)
- API keys MUST be server-side only âœ…
- Use IP-based rate limiting âœ…
- Implement request validation and sanitization âœ…
- Log voice usage for monitoring âœ…
- **GÃœLSU TRACKING**: Monitor default voice usage patterns

### Firebase Security
```javascript
// firestore.rules
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /progress/{userId} {
      allow read, write: if request.auth != null && 
                           request.auth.uid == userId;
    }
    
    match /modules/{moduleId} {
      allow read: if request.auth != null;
      allow write: if request.auth.token.admin == true;
    }
  }
}
```

## Admin Panel Rules

### ElevenLabs Test Interface
- Provide gender-based voice filtering (Male/Female/All)
- Show real-time voice statistics
- Include Turkish character testing capabilities
- Display API status and usage metrics
- Enable bulk audio file generation
- **GÃœLSU MONITORING**: Track default voice performance metrics

### User Management
- Implement role-based access (admin, educator, parent)
- Provide comprehensive analytics dashboard
- Enable data export for GDPR compliance
- Support bulk user operations

## Accessibility Standards

### WCAG 2.1 AA Compliance (ACHIEVED âœ…)
- Minimum 44px touch targets âœ…
- Color contrast ratio 4.5:1 for text âœ…
- Keyboard navigation support âœ…
- Screen reader compatibility âœ…
- Focus indicators on all interactive elements âœ…
- Alternative text for all images and audio content âœ…

### Autism-Specific Accessibility
- Sensory control panel (theme, sounds, animations)
- Predictable navigation patterns
- Clear visual hierarchy
- Immediate feedback for all actions
- Option to reduce motion and animations
- Customizable text size and contrast
- **CONSISTENCY**: GÃ¼lsu voice for predictable audio experience

## Development Workflow

### Git Workflow
- Feature branches: `feature/module-name` or `feature/voice-enhancement`
- Commit messages in English: "feat: add Turkish character mapping"
- PR requirements: Tests passing, accessibility check, performance audit

### Environment Setup
```bash
# Required environment variables
ELEVENLABS_API_KEY=your_key_here          # Server-side only
NEXT_PUBLIC_FIREBASE_PROJECT_ID=your_id   # Client-safe
NODE_ENV=development
```

### Code Quality
- ESLint + Prettier for consistent formatting
- Husky pre-commit hooks for linting
- TypeScript strict mode enforcement
- Performance monitoring with Core Web Vitals

## Error Handling

### Graceful Degradation (IMPLEMENTED âœ…)
```typescript
// Voice system with fallback and GÃ¼lsu default
export async function speakWithFallback(text: string, type: ContentType) {
  try {
    // 1. Try static audio file
    const staticAudio = getStaticAudioPath(text, type);
    if (staticAudio) return await playAudio(staticAudio);
    
    // 2. Try ElevenLabs SDK with GÃ¼lsu voice
    return await elevenLabsSpeak(text, type, GULSU_VOICE.id);
    
  } catch (error) {
    // 3. Fallback to Web Speech API
    console.warn('ElevenLabs failed, using Web Speech API');
    return await webSpeechSpeak(text);
  }
}
```

### User-Friendly Error Messages
- Display errors in Turkish
- Provide specific guidance for each error type
- Include contact information for technical support
- Log errors for debugging while protecting user privacy

## ğŸ¯ DEVELOPMENT PRIORITIES (2025-01-06)

### HIGH PRIORITY
1. **Generate Missing MP3 Files**: Use GÃ¼lsu voice for remaining dialogs
2. **Test Static Audio System**: Comprehensive testing of file priority system  
3. **Performance Monitoring**: Track static vs dynamic audio usage
4. **Dialog System Enhancement**: Add more module-specific dialogs

### MEDIUM PRIORITY
1. **Optimize Other Modules**: Apply static audio to remaining modules
2. **Enhanced Analytics**: Track GÃ¼lsu voice user satisfaction
3. **Mobile Optimization**: Ensure GÃ¼lsu voice works on all devices
4. **Accessibility Testing**: Comprehensive screen reader testing

### LOW PRIORITY
1. **Voice Personalization**: Optional voice preferences while keeping GÃ¼lsu default
2. **Advanced Analytics**: Voice usage patterns and effectiveness metrics
3. **Content Expansion**: More Turkish dialogs for specific learning scenarios

## ğŸ“‹ KEY FILES TO REFERENCE

### âœ… IMPLEMENTED FILES
- `docs/dialog.md` - Comprehensive Turkish dialogs catalog (94 dialogs)
- `lib/audio-constants.ts` - Enhanced with all dialog mappings
- `lib/elevenlabs.ts` - GÃ¼lsu default voice implementation
- `console-log.md` - Success tracking and error resolution log
- `fail-report.md` - Platform recovery success story

### ğŸ¯ NEXT ACTIONS
- Test static audio priority system comprehensively
- Generate missing MP3 files using GÃ¼lsu voice
- Monitor static vs dynamic audio usage ratios
- Enhance dialog system with more module-specific content

Remember: This platform serves children with autism spectrum disorders. Every design and development decision should prioritize accessibility, clarity, and positive user experience. **GÃ¼lsu voice provides the consistent, calm, and reliable audio experience that helps autistic children feel safe and supported in their learning journey.**

---

> **ğŸ† PLATFORM STATUS**: Production-ready with GÃ¼lsu default voice system, comprehensive dialog catalog, and optimized static audio priority. All 9 modules active and accessible for supporting autism spectrum development in Turkish children. 